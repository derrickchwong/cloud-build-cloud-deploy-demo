steps:
- name: 'gcr.io/cloud-builders/mvn'
  args: ['test']

#- name: 'gcr.io/k8s-skaffold/pack'
#  entrypoint: 'pack'
#  args:
#  - build
#  - --builder=gcr.io/buildpacks/builder
#  - --publish
#  - us-central1-docker.pkg.dev/container-developer/repo/helloworld:$COMMIT_SHA

- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'gcloud'
  args:
  - builds
  - submit
  - .
  - --pack=image=us-central1-docker.pkg.dev/container-developer/repo/helloworld:$COMMIT_SHA

- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: 'gcloud'
  args:
  - deploy
  - releases
  - create
  - test-release-$SHORT_SHA
  - --project=container-developer
  - --region=us-central1
  - --delivery-pipeline=my-gke-demo-app-1
  - --images=us-central1-docker.pkg.dev/container-developer/repo/helloworld=us-central1-docker.pkg.dev/container-developer/repo/helloworld:$COMMIT_SHA